{"ast":null,"code":"import axios from 'axios';\nimport _ from 'lodash';\nimport log from '../../util/log';\nimport { DateTime } from 'luxon';\nimport Big from 'big.js';\nexport const loadPool = () => async (dispatch, getState) => {\n  const contractAddress = getState().pool.contractAddress;\n  log.info('store:pool:load', contractAddress);\n  dispatch({\n    type: 'POOL_LOADING'\n  });\n  Promise.all([// getPrice(contractAddress),\n  // getStaSupply(contractAddress),\n  // getWStaSupply(contractAddress),\n  getChartData(contractAddress)]).then(_results => {\n    const anyErrors = _.some(_results, result => result.status === 'error');\n\n    log.info('store:statera:load:complete', _results, 'anyErrors?', anyErrors);\n\n    if (anyErrors) {\n      dispatch({\n        type: 'POOL_ERROR'\n      });\n    } else {\n      dispatch({\n        type: 'POOL_SUCCESS',\n        payload: _results\n      });\n    }\n  });\n}; // Chart\n\nconst getChartData = contractAddress => {\n  return new Promise(resolve => {\n    axios.post('https://api.thegraph.com/subgraphs/name/uniswap/uniswap-v2', {\n      query: `\n        {\n          pairDayDatas(\n            where: { pairAddress: \"${contractAddress}\" }\n            orderBy:date\n            orderDirection:desc\n            first:365)\n            {\n              date\n              reserveUSD\n              dailyVolumeUSD\n            }\n        }\n      `\n    }).then(_res => {\n      log.info('pool:getChartData:success', _res.data.data);\n      let data = _res.data.data.pairDayDatas;\n      data.reverse();\n      let volume = [];\n      let liquidity = [];\n      let feeReturns = [];\n      data.forEach(item => {\n        const date = DateTime.fromSeconds(item.date).toISO();\n        const parsedVolume = Big(item.dailyVolumeUSD).toNumber();\n        const parsedLiquidity = Big(item.reserveUSD).toNumber();\n        const parsedFeeReturns = Math.pow(parsedVolume * 0.003 / parsedLiquidity + 1, 365) - 1;\n        volume.push([date, parsedVolume]);\n        liquidity.push([date, parsedLiquidity]);\n        feeReturns.push([date, parsedFeeReturns]);\n      });\n\n      const day1ApyItems = _.takeRight(feeReturns, 1);\n\n      const day7ApyItems = _.takeRight(feeReturns, 7);\n\n      const day30ApyItems = _.takeRight(feeReturns, 30);\n\n      resolve({\n        name: 'chart',\n        status: 'success',\n        result: {\n          chart: {\n            volume,\n            liquidity,\n            feeReturns\n          },\n          apy: {\n            day1: day1ApyItems[0][1],\n            day7: _.meanBy(day7ApyItems, item => item[1]),\n            day30: _.meanBy(day30ApyItems, item => item[1])\n          }\n        }\n      });\n    }).catch(_error => {\n      resolve({\n        name: 'chart',\n        status: 'error',\n        result: _error\n      });\n    });\n  });\n};","map":{"version":3,"sources":["/Users/nco/Documents/GitHub/dashboard/src/store/actions/pool.ts"],"names":["axios","_","log","DateTime","Big","loadPool","dispatch","getState","contractAddress","pool","info","type","Promise","all","getChartData","then","_results","anyErrors","some","result","status","payload","resolve","post","query","_res","data","pairDayDatas","reverse","volume","liquidity","feeReturns","forEach","item","date","fromSeconds","toISO","parsedVolume","dailyVolumeUSD","toNumber","parsedLiquidity","reserveUSD","parsedFeeReturns","Math","pow","push","day1ApyItems","takeRight","day7ApyItems","day30ApyItems","name","chart","apy","day1","day7","meanBy","day30","catch","_error"],"mappings":"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","sourcesContent":["import axios from 'axios'\r\nimport { Dispatch } from 'redux'\r\nimport _ from 'lodash'\r\nimport log from '../../util/log'\r\nimport { DateTime } from 'luxon'\r\nimport Big from 'big.js'\r\n\r\nexport const loadPool = () => async (dispatch:Dispatch, getState:any) => {\r\n  const contractAddress:string = getState().pool.contractAddress\r\n  log.info('store:pool:load', contractAddress)\r\n  dispatch({ type: 'POOL_LOADING' })\r\n\r\n  Promise.all([\r\n    // getPrice(contractAddress),\r\n    // getStaSupply(contractAddress),\r\n    // getWStaSupply(contractAddress),\r\n    getChartData(contractAddress),\r\n  ])\r\n    .then(_results => {\r\n      const anyErrors = _.some(_results, (result:any) => result.status === 'error')\r\n      log.info('store:statera:load:complete', _results, 'anyErrors?', anyErrors)\r\n\r\n      if (anyErrors) {\r\n        dispatch({ type: 'POOL_ERROR' })\r\n      } else {\r\n        dispatch({ type: 'POOL_SUCCESS', payload: _results })\r\n      }\r\n    })\r\n}\r\n\r\n\r\n// Chart\r\n\r\nconst getChartData = (contractAddress:string) => {\r\n  return new Promise(resolve => {\r\n    axios.post('https://api.thegraph.com/subgraphs/name/uniswap/uniswap-v2', {\r\n      query: `\r\n        {\r\n          pairDayDatas(\r\n            where: { pairAddress: \"${contractAddress}\" }\r\n            orderBy:date\r\n            orderDirection:desc\r\n            first:365)\r\n            {\r\n              date\r\n              reserveUSD\r\n              dailyVolumeUSD\r\n            }\r\n        }\r\n      `\r\n    })\r\n      .then(_res => {\r\n        log.info('pool:getChartData:success', _res.data.data)\r\n        let data = _res.data.data.pairDayDatas\r\n        data.reverse()\r\n\r\n        let volume:any = []\r\n        let liquidity:any = []\r\n        let feeReturns:any = []\r\n\r\n        data.forEach((item:any) => {\r\n          const date = DateTime.fromSeconds(item.date).toISO()\r\n          const parsedVolume = Big(item.dailyVolumeUSD).toNumber()\r\n          const parsedLiquidity = Big(item.reserveUSD).toNumber()\r\n          const parsedFeeReturns = (Math.pow((((parsedVolume * 0.003) / parsedLiquidity) + 1), 365)) -1\r\n\r\n          volume.push([\r\n            date,\r\n            parsedVolume,\r\n          ])\r\n\r\n          liquidity.push([\r\n            date,\r\n            parsedLiquidity,\r\n          ])\r\n\r\n          feeReturns.push([\r\n            date,\r\n            parsedFeeReturns,\r\n          ])\r\n        })\r\n\r\n        const day1ApyItems:any = _.takeRight(feeReturns, 1)\r\n        const day7ApyItems:any = _.takeRight(feeReturns, 7)\r\n        const day30ApyItems:any = _.takeRight(feeReturns, 30)\r\n\r\n        resolve({\r\n          name: 'chart',\r\n          status: 'success',\r\n          result: {\r\n            chart: {\r\n              volume,\r\n              liquidity,\r\n              feeReturns,\r\n            },\r\n            apy: {\r\n              day1: day1ApyItems[0][1],\r\n              day7: _.meanBy(day7ApyItems, (item:any) => item[1]),\r\n              day30: _.meanBy(day30ApyItems, (item:any) => item[1]),\r\n            },\r\n          },\r\n        })\r\n      })\r\n      .catch(_error => {\r\n        resolve({\r\n          name: 'chart',\r\n          status: 'error',\r\n          result: _error\r\n        })\r\n      })\r\n  })\r\n}\r\n"]},"metadata":{},"sourceType":"module"}